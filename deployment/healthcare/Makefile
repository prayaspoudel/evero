# Healthcare Module Deployment Makefile
# This Makefile handles deployment operations for the healthcare module

.PHONY: help setup build deploy clean logs migrate migrate-down health docker-build docker-up docker-down

MODULE := healthcare
BINARY := bin/healthcare
CONFIG_DIR := config/healthcare
DEPLOYMENT_DIR := deployment/healthcare

help: ## Display this help screen
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-30s\033[0m %s\n", $$1, $$2}'

setup: ## Complete setup for healthcare module
	@echo "ğŸ¥ Setting up Healthcare module..."
	@./setup.sh
	@echo "âœ… Healthcare module setup complete"

build: ## Build the healthcare module
	@echo "ğŸ”¨ Building Healthcare module..."
	@cd ../.. && go build -o $(BINARY) ./app/healthcare
	@echo "âœ… Build complete: $(BINARY)"

run: ## Run the healthcare module locally
	@echo "â–¶ï¸  Running Healthcare module..."
	@cd ../.. && ./$(BINARY) --config=$(CONFIG_DIR)/local.json

run-dev: ## Run in development mode
	@echo "â–¶ï¸  Running Healthcare module (development)..."
	@cd ../.. && ./$(BINARY) --config=$(CONFIG_DIR)/development.json

run-stage: ## Run in staging mode
	@echo "â–¶ï¸  Running Healthcare module (staging)..."
	@cd ../.. && ./$(BINARY) --config=$(CONFIG_DIR)/stage.json

run-prod: ## Run in production mode
	@echo "â–¶ï¸  Running Healthcare module (production)..."
	@cd ../.. && ./$(BINARY) --config=$(CONFIG_DIR)/production.json

migrate: ## Run database migrations
	@echo "ğŸ“¦ Running Healthcare module migrations..."
	@cd ../.. && go run ./infrastructure/database/migrate.go --module=healthcare --direction=up
	@echo "âœ… Migrations complete"

migrate-down: ## Rollback database migrations
	@echo "âª Rolling back Healthcare module migrations..."
	@cd ../.. && go run ./infrastructure/database/migrate.go --module=healthcare --direction=down
	@echo "âœ… Rollback complete"

test: ## Run tests
	@echo "ğŸ§ª Running Healthcare module tests..."
	@cd ../.. && go test -v ./app/healthcare/...
	@echo "âœ… Tests complete"

test-coverage: ## Run tests with coverage
	@echo "ğŸ§ª Running Healthcare module tests with coverage..."
	@cd ../.. && go test -v -coverprofile=coverage-healthcare.out ./app/healthcare/...
	@cd ../.. && go tool cover -html=coverage-healthcare.out
	@echo "âœ… Coverage report generated"

docker-build: ## Build Docker image
	@echo "ğŸ³ Building Healthcare module Docker image..."
	@docker build -f Dockerfile -t evero-healthcare:latest ../..
	@echo "âœ… Docker image built"

docker-up: ## Start Docker containers
	@echo "ğŸ³ Starting Healthcare module containers..."
	@docker-compose up -d
	@echo "âœ… Containers started"

docker-down: ## Stop Docker containers
	@echo "ğŸ³ Stopping Healthcare module containers..."
	@docker-compose down
	@echo "âœ… Containers stopped"

docker-logs: ## View Docker logs
	@docker-compose logs -f healthcare

deploy: build migrate ## Deploy the healthcare module (build + migrate)
	@echo "ğŸš€ Deploying Healthcare module..."
	@echo "âœ… Deployment complete"

clean: ## Clean build artifacts
	@echo "ğŸ§¹ Cleaning Healthcare module artifacts..."
	@cd ../.. && rm -rf $(BINARY)
	@cd ../.. && rm -f coverage-healthcare.out
	@echo "âœ… Clean complete"

health: ## Check module health
	@echo "ğŸ¥ Checking Healthcare module health..."
	@curl -f http://localhost:3001/health || echo "âŒ Health check failed"

logs: ## View application logs
	@echo "ğŸ“‹ Viewing Healthcare module logs..."
	@tail -f ../../logs/healthcare.log

.DEFAULT_GOAL := help
